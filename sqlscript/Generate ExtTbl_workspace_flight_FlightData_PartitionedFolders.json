{
	"name": "Generate ExtTbl_workspace_flight_FlightData_PartitionedFolders",
	"properties": {
		"content": {
			"query": "-- DROP EXTERNAL TABLE [dbo].[ExtTbl_workspace_flight_FlightData_PartitionedFolders]\n-- DROP EXTERNAL FILE FORMAT [ExtFileFormat_workspace_flight_FlightData_PartitionedFolders] \n-- DROP EXTERNAL DATA SOURCE [ExtDataSource_workspace_flight_FlightData_PartitionedFolders] \n/*\nNOTE: \nConcept of \"Folder partition elimination\"\nThe native external tables in Synapse pools are able to ignore the files placed in the folders that are not relevant for the queries. \nIf your files are stored in a folder hierarchy (for example - /year=2020/month=03/day=16) and the values for year, month, and day \nare exposed as the columns, the queries that contain filters like year=2020 will read the files only from the subfolders placed within \nthe year=2020 folder. The files and folders placed in other folders (year=2021 or year=2022) will be ignored in this query. \nThis elimination is known as partition elimination.\nref: https://learn.microsoft.com/en-us/azure/synapse-analytics/sql/develop-tables-external-tables?tabs=hadoop\n\n*/\n\nIF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'ExtFileFormat_workspace_flight_FlightData_PartitionedFolders') \n\tCREATE EXTERNAL FILE FORMAT [ExtFileFormat_workspace_flight_FlightData_PartitionedFolders] \n\tWITH ( FORMAT_TYPE = PARQUET)\nGO\n\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'ExtDataSource_workspace_flight_FlightData_PartitionedFolders') \n\tCREATE EXTERNAL DATA SOURCE [ExtDataSource_workspace_flight_FlightData_PartitionedFolders] \n\tWITH (\n\t\tLOCATION = 'abfss://filesystem-synapse-workspace@storagedatalake12321.dfs.core.windows.net' \n\t)\nGO\n\n-- LOCATION = 'FlightData/PartitionByStateAndDay/**',\n\nCREATE EXTERNAL TABLE ExtTbl_workspace_flight_FlightData_PartitionedFolders (\n\t[Year] nvarchar(4000),\n\t[Quarter] nvarchar(4000),\n\t[Month] nvarchar(4000),\n\t[DayOfWeek] nvarchar(4000),\n\t[FlightDate] nvarchar(4000),\n\t[Reporting_Airline] nvarchar(4000),\n\t[DOT_ID_Reporting_Airline] nvarchar(4000),\n\t[IATA_CODE_Reporting_Airline] nvarchar(4000),\n\t[Tail_Number] nvarchar(4000),\n\t[Flight_Number_Reporting_Airline] nvarchar(4000),\n\t[OriginAirportID] nvarchar(4000),\n\t[OriginAirportSeqID] nvarchar(4000),\n\t[OriginCityMarketID] nvarchar(4000),\n\t[Origin] nvarchar(4000),\n\t[OriginCityName] nvarchar(4000),\n\t[OriginStateFips] nvarchar(4000),\n\t[OriginStateName] nvarchar(4000),\n\t[OriginWac] nvarchar(4000),\n\t[DestAirportID] nvarchar(4000),\n\t[DestAirportSeqID] nvarchar(4000),\n\t[DestCityMarketID] nvarchar(4000),\n\t[Dest] nvarchar(4000),\n\t[DestCityName] nvarchar(4000),\n\t[DestState] nvarchar(4000),\n\t[DestStateFips] nvarchar(4000),\n\t[DestStateName] nvarchar(4000),\n\t[DestWac] nvarchar(4000),\n\t[CRSDepTime] nvarchar(4000),\n\t[DepTime] nvarchar(4000),\n\t[DepDelay] nvarchar(4000),\n\t[DepDelayMinutes] nvarchar(4000),\n\t[DepDel15] nvarchar(4000),\n\t[DepartureDelayGroups] nvarchar(4000),\n\t[DepTimeBlk] nvarchar(4000),\n\t[TaxiOut] nvarchar(4000),\n\t[WheelsOff] nvarchar(4000),\n\t[WheelsOn] nvarchar(4000),\n\t[TaxiIn] nvarchar(4000),\n\t[CRSArrTime] nvarchar(4000),\n\t[ArrTime] nvarchar(4000),\n\t[ArrDelay] nvarchar(4000),\n\t[ArrDelayMinutes] nvarchar(4000),\n\t[ArrDel15] nvarchar(4000),\n\t[ArrivalDelayGroups] nvarchar(4000),\n\t[ArrTimeBlk] nvarchar(4000),\n\t[Cancelled] nvarchar(4000),\n\t[CancellationCode] nvarchar(4000),\n\t[Diverted] nvarchar(4000),\n\t[CRSElapsedTime] nvarchar(4000),\n\t[ActualElapsedTime] nvarchar(4000),\n\t[AirTime] nvarchar(4000),\n\t[Flights] nvarchar(4000),\n\t[Distance] nvarchar(4000),\n\t[DistanceGroup] nvarchar(4000),\n\t[CarrierDelay] nvarchar(4000),\n\t[WeatherDelay] nvarchar(4000),\n\t[NASDelay] nvarchar(4000),\n\t[SecurityDelay] nvarchar(4000),\n\t[LateAircraftDelay] nvarchar(4000)\n\t)\n\tWITH (\n\tLOCATION = 'FlightData/PartitionByStateAndDay/**',\n\tDATA_SOURCE = [ExtDataSource_workspace_flight_FlightData_PartitionedFolders],\n\tFILE_FORMAT = [ExtFileFormat_workspace_flight_FlightData_PartitionedFolders]\n\t)\nGO\n\n\n-- SELECT TOP 1 CONVERT(nvarchar(100), [OriginStateFips]) FROM dbo.ExtTbl_workspace_flight_FlightData_PartitionedFolders\nSELECT TOP 10 * FROM dbo.ExtTbl_workspace_flight_FlightData_PartitionedFolders Where [OriginStateName] != 'Arizona'\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "workload_SQL_Database_mak",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}